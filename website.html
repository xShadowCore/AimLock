<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>AimLock</title>
<style>
  :root{
    --bg-img: url('https://images.unsplash.com/photo-1570284613060-766c33850e00?q=80&w=1170&auto=format&fit=crop&ixlib=rb-4.1.0');
    --glass: rgba(4,6,12,0.6);
    --accent1: #7b5fff;
    --accent2: #a17bff;
  }
  * { box-sizing: border-box; margin:0; padding:0; }
  body {
    font-family: "Segoe UI", Roboto, Arial, sans-serif;
    color: #fff;
    background: var(--bg-img) center/cover no-repeat fixed;
    min-height: 100vh;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 20px;
    padding: 40px 20px 80px;
    transition: background-color .2s, color .2s;
  }
  /* light theme */
  body.light {
    background: #f3f4f6;
    color: #111827;
  }
  .header {
    position: fixed;
    top: 18px;
    left: 20px;
    right: 20px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    pointer-events: none;
    z-index: 1000;
  }
  .owner-access {
    pointer-events: auto;
    display:flex;
    align-items:center;
    gap:8px;
    margin-right:8px;
    color: #d1d5db;
    font-size:13px;
  }
  .brand {
    pointer-events: auto;
    background: rgba(0,0,0,0.5);
    padding: 12px 16px;
    border-radius: 10px;
    box-shadow: 0 6px 30px rgba(0,0,0,0.6);
    font-weight:700;
  }
  body.light .brand { background: rgba(255,255,255,0.85); color: #111; box-shadow:none; }
  .auth {
    pointer-events: auto;
    display:flex;
    align-items:center;
    gap:10px;
    position: relative;
  }
  .user-badge {
    display:flex;
    align-items:center;
    gap:10px;
    background: rgba(0,0,0,0.45);
    padding:6px 10px;
    border-radius:10px;
    font-size:14px;
    position: relative;
  }
  body.light .user-badge { background: rgba(255,255,255,0.85); color:#111; }
  .user-badge img.avatar {
    width:34px;
    height:34px;
    border-radius:50%;
    object-fit:cover;
    border:1px solid rgba(255,255,255,0.06);
    cursor: default;
  }
  /* settings icon (user provided) */
  #settingsIcon {
    width:28px;
    height:28px;
    cursor: pointer;
    border-radius:6px;
    object-fit:cover;
    background: rgba(255,255,255,0.02);
    padding:2px;
    display:none; /* shown only when logged in */
  }
  body.light #settingsIcon { background: rgba(0,0,0,0.04); }

  .settings-menu {
    display:none;
    position:absolute;
    top:48px;
    right:0;
    background: rgba(0,0,0,0.85);
    padding:12px;
    border-radius:10px;
    box-shadow: 0 6px 20px rgba(0,0,0,0.6);
    z-index: 1100;
    width:260px;
  }
  body.light .settings-menu { background: #fff; color:#111; box-shadow:none; border:1px solid rgba(0,0,0,0.08); }
  .settings-menu label { font-size:12px; opacity:0.95; display:block; margin-bottom:6px; }
  .settings-menu input, .settings-menu select {
    width:100%; padding:8px 10px; border-radius:6px; border:0; margin-bottom:8px;
  }
  body.light .settings-menu input, body.light .settings-menu select { border:1px solid #e5e7eb; }

  .logo {
    background: rgba(0,0,0,0.5);
    padding: 18px 30px;
    border-radius: 12px;
    text-align: center;
    box-shadow: 0 6px 30px rgba(0,0,0,0.6);
  }
  body.light .logo { background: rgba(255,255,255,0.85); color:#111; box-shadow:none; }
  .logo h1 { font-size: 34px; letter-spacing: 1px; margin-bottom: 6px; color: #d9b8ff; }
  body.light .logo h1 { color:#6b21a8; }

  .cards { display:flex; gap:24px; justify-content:center; width:100%; max-width:1100px; flex-wrap: wrap; margin-top:120px; }
  .card {
    background: rgba(10,20,30,0.45);
    padding: 26px;
    border-radius: 14px;
    width: 320px;
    text-align:center;
    border: 1px solid rgba(255,255,255,0.06);
    backdrop-filter: blur(6px);
  }
  body.light .card { background: #fff; color:#111; border:1px solid #e6e6e6; }
  .card h3 { margin-bottom: 8px; font-size:20px; }
  .card p { font-size:14px; color: #dfe9f2; opacity:0.9; }
  body.light .card p { color:#374151; opacity:0.95; }

  .show-versions-btn {
    position: fixed;
    bottom: 24px;
    left: 50%;
    transform: translateX(-50%);
    background: linear-gradient(90deg,var(--accent1),var(--accent2));
    padding: 12px 22px;
    border-radius: 28px;
    border: none;
    color: white;
    font-size:16px;
    cursor:pointer;
    box-shadow: 0 8px 30px rgba(123,91,255,0.15);
  }

  .btn { display:inline-block; padding:8px 12px; border-radius:8px; text-decoration:none; font-weight:600; border: none; cursor:pointer; }
  .btn.discord { background: linear-gradient(90deg,#7289da,#99a9ff); color: #fff; padding:10px 18px; border-radius:24px; }
  .btn.tiktok { background: linear-gradient(90deg,#25f4ee,#fe2c55); color: #fff; padding:10px 18px; border-radius:24px; }
  .btn.soon { background: rgba(255,255,255,0.06); color: #eee; cursor: default; }
  .btn.download { background: linear-gradient(90deg,#6fb3ff,#7b5fff); color:#041024; }

  .favorite { display:inline-flex; gap:6px; align-items:center; margin-top:8px; }
  .favorite button { background:transparent; border:1px solid rgba(255,255,255,0.06); color:#fff; padding:6px 8px; border-radius:8px; cursor:pointer; }
  body.light .favorite button { border:1px solid #e6e6e6; color:#111; }

  .overlay { position: fixed; inset: 0; display: none; align-items: center; justify-content: center; background: rgba(6,8,12,0.6); z-index: 999; padding: 20px; }
  .menu { width: 100%; max-width: 760px; background: rgba(4,6,12,0.6); padding: 22px; border-radius: 12px; display: grid; grid-template-columns: repeat(2,1fr); gap: 12px; border: 1px solid rgba(255,255,255,0.05); position: relative; }
  body.light .menu { background: #fff; color:#111; border:1px solid #e6e6e6; }
  .version { background: rgba(255,255,255,0.03); padding: 12px; border-radius: 8px; text-align:center; }
  body.light .version { background: transparent; }
  .close-x { position:absolute; top:20px; right:20px; color:#fff; font-size:18px; background:transparent; border:0; cursor:pointer; }
  body.light .close-x { color:#111; }

  /* owner button */
  #ownerAccessContainer { pointer-events: auto; display:flex; align-items:center; gap:8px; }
  #ownerBtn { width:36px; height:36px; cursor:pointer; border-radius:8px; background:transparent; }
  #ownerStatusText { font-size:13px; color:#f3f4f6; }
  body.light #ownerStatusText { color:#111; }

  @media (max-width:700px) { .cards { flex-direction: column; align-items:center } .menu { grid-template-columns: 1fr; } }

  /* small helpers */
  .muted { opacity: .75; font-size:13px; }
</style>
</head>
<body>

  <div class="header">
    <div id="ownerAccessContainer" class="owner-access" aria-hidden="true">
      <!-- Dynamic owner button / message inserted here -->
    </div>

    <div class="brand"></div>
    <div class="auth" id="authArea">
      <div id="userBadge" class="user-badge" style="display:none;">
        <img id="avatarImg" class="avatar" src="" alt="avatar">
        <div id="usernameText">User</div>
        <button id="signOutBtn" class="btn" style="margin-left:8px; padding:6px 10px; border-radius:8px; background:rgba(255,255,255,0.06); color:#fff;">Sign out</button>
        <!-- settings icon (user provided) -->
        <img id="settingsIcon" src="https://icons.veryicon.com/png/o/miscellaneous/user-center/account-settings-11.png" alt="Settings" title="Open settings">
        <div id="settingsMenu" class="settings-menu" role="menu" aria-hidden="true">
          <label for="nameInput">Display name</label>
          <input id="nameInput" placeholder="Display name">

          <label for="avatarInput">Avatar URL</label>
          <input id="avatarInput" placeholder="https://...">

          <label for="themeSelect">Theme</label>
          <select id="themeSelect">
            <option value="dark">Dark</option>
            <option value="light">Light</option>
          </select>

          <div style="display:flex; gap:8px; justify-content:flex-end; margin-top:6px;">
            <button id="saveSettings" class="btn">Save</button>
            <button id="clearSettings" class="btn" style="background:rgba(255,255,255,0.06)">Reset</button>
          </div>
        </div>
      </div>

      <button id="signInBtn" class="btn discord">Register / Sign in</button>
    </div>
  </div>

  <div class="logo">
    <h1>AimLock</h1>
    <div class="muted">The HackClient for Minecraft</div>
  </div>

  <div class="cards" aria-hidden="true">
    <div class="card">
      <h3>Links</h3>
      <p>Join our Discord for support and the mod</p>
      <button class="btn discord" onclick="window.open('https://discord.com/invite/NMxqjrJ4Au','_blank')">Discord</button>
      <p>Visit our store</p>
      <button class="btn discord" onclick="window.open('https://aimlock.mysellauth.com/','_blank')">Store</button>
    </div>

    <div class="card">
      <h3>TikTok</h3>
      <p>Follow us on TikTok for updates!</p>
      <button class="btn tiktok" onclick="window.open('https://www.tiktok.com','_blank')">TikTok</button>
    </div>

    <div class="card" id="ownersCard">
      <h3>Owners</h3>
      <p>xShadowCore<br>UserID: 1109112702347006053</p>
      <p><br></p>
      <p>valentineeee<br>UserID: 1176185201957802075</p>
      <!-- owner indicator (dynamically filled) -->
      <div id="ownerIndicator" style="margin-top:12px; font-size:14px; color:#dfe9f2;"></div>
    </div>

    <div class="card">
      <h3>Status</h3>
      <p>The mod is currently still in development. Join our Discord to not miss the release.</p>
    </div>
  </div>

  <button class="show-versions-btn" id="openMenuBtn">Show versions</button>

  <div id="overlay" class="overlay">
    <div class="menu" role="dialog" aria-modal="true" aria-label="Menu">
      <button id="closeBtn" class="close-x" title="Close">✕</button>
    </div>
  </div>

<script>
/* ---------- OAUTH CONFIG ---------- */
const CLIENT_ID = '1441317350010785962';
const REDIRECT_URI = 'https://xshadowcore.github.io/AimLock/website';
const SCOPES = 'identify';

/* OWNER IDS */
const OWNER_IDS = ['1109112702347006053', '1176185201957802075'];

/* OAuth helpers */
function buildDiscordOAuthUrl() {
  const base = 'https://discord.com/oauth2/authorize';
  const params = new URLSearchParams({
    client_id: CLIENT_ID,
    redirect_uri: REDIRECT_URI,
    response_type: 'token',
    scope: SCOPES,
    prompt: 'consent'
  });
  return `${base}?${params.toString()}`;
}
function parseHashToken() {
  if (!window.location.hash) return null;
  const hash = window.location.hash.substring(1);
  const params = new URLSearchParams(hash);
  return params.get('access_token');
}
function saveToken(token){ if(!token) return; sessionStorage.setItem('discord_token', token); }
function loadToken(){ return sessionStorage.getItem('discord_token'); }
function clearToken(){ sessionStorage.removeItem('discord_token'); }

/* avatar helpers */
function defaultAvatarUrl(discriminator) {
  const idx = (parseInt(discriminator) || 0) % 5;
  return `https://cdn.discordapp.com/embed/avatars/${idx}.png`;
}
function avatarUrl(user) {
  if (!user) return defaultAvatarUrl(0);
  if (user.avatar) {
    const isAnimated = user.avatar.startsWith('a_');
    const ext = isAnimated ? 'gif' : 'png';
    return `https://cdn.discordapp.com/avatars/${user.id}/${user.avatar}.${ext}`;
  }
  return defaultAvatarUrl(user.discriminator);
}

/* state */
let CURRENT_USER_ID = null;
let CURRENT_DISCORD_USER = null;

/* helper to update owner-access UI */
function updateOwnerAccessUI() {
  const container = document.getElementById('ownerAccessContainer');
  container.innerHTML = '';

  // If signed in and owner, show button (image)
  if (CURRENT_USER_ID && OWNER_IDS.includes(CURRENT_USER_ID)) {
    const img = document.createElement('img');
    img.id = 'ownerBtn';
    img.src = 'https://cdn3.emoji.gg/emojis/8335-developer.png';
    img.alt = 'Owner Button';
    img.title = 'Owner Access';
    img.addEventListener('click', () => {
      // minimal owner action: open a small alert indicating access (keeps behavior minimal)
      alert('Owner button clicked — access granted.');
    });
    container.appendChild(img);

    // show indicator under owners card
    const indicator = document.getElementById('ownerIndicator');
    if (indicator) {
      // display which owner is logged in (use username if available)
      const name = (CURRENT_DISCORD_USER && (CURRENT_DISCORD_USER.username)) ? CURRENT_DISCORD_USER.username : 'Owner';
      indicator.textContent = `Owner signed in: ${name} (${CURRENT_USER_ID})`;
    }
  } else {
    // not owner: show message
    const span = document.createElement('span');
    span.id = 'ownerStatusText';
    span.textContent = '© AimLock';
    container.appendChild(span);

    // clear owners card indicator
    const indicator = document.getElementById('ownerIndicator');
    if (indicator) indicator.textContent = '';
  }
}

/* fetch Discord user and show UI */
async function fetchAndShowUser(token) {
  try {
    const res = await fetch('https://discord.com/api/users/@me', {
      headers: { Authorization: `Bearer ${token}`, Accept: 'application/json' }
    });
    if (!res.ok) { signOut(); return; }
    const user = await res.json();
    CURRENT_USER_ID = user.id;
    CURRENT_DISCORD_USER = user;

    // load per-user settings
    const saved = JSON.parse(localStorage.getItem('user_settings_' + user.id) || 'null');
    const displayName = (saved && saved.displayName) ? saved.displayName : `${user.username}#${user.discriminator}`;
    const avatarSrc = (saved && saved.avatarUrl) ? saved.avatarUrl : avatarUrl(user);

    document.getElementById('avatarImg').src = avatarSrc;
    document.getElementById('usernameText').textContent = displayName;

    // fill settings inputs
    document.getElementById('nameInput').value = saved && saved.displayName ? saved.displayName : '';
    document.getElementById('avatarInput').value = saved && saved.avatarUrl ? saved.avatarUrl : '';
    document.getElementById('themeSelect').value = saved && saved.theme ? saved.theme : 'dark';

    // show elements
    document.getElementById('userBadge').style.display = 'flex';
    document.getElementById('settingsIcon').style.display = 'inline-block';
    document.getElementById('signInBtn').style.display = 'none';

    // apply theme
    applyTheme(document.getElementById('themeSelect').value);

    // update owner UI
    updateOwnerAccessUI();
  } catch (err) {
    console.error('Error fetching Discord user:', err);
  }
}

/* sign in/out */
document.getElementById('signInBtn').addEventListener('click', () => {
  window.location.href = buildDiscordOAuthUrl();
});
document.getElementById('signOutBtn').addEventListener('click', () => {
  signOut();
});
function signOut(){
  clearToken();
  CURRENT_USER_ID = null;
  CURRENT_DISCORD_USER = null;
  document.getElementById('userBadge').style.display = 'none';
  document.getElementById('settingsIcon').style.display = 'none';
  document.getElementById('signInBtn').style.display = 'inline-block';
  // reset theme to dark by default
  applyTheme('dark');
  history.replaceState({}, '', REDIRECT_URI);
  updateOwnerAccessUI();
}

/* settings menu behavior (settings icon click opens menu) */
const settingsIcon = document.getElementById('settingsIcon');
const settingsMenu = document.getElementById('settingsMenu');
settingsIcon.addEventListener('click', () => {
  if (!CURRENT_USER_ID) return;
  settingsMenu.style.display = settingsMenu.style.display === 'block' ? 'none' : 'block';
});

/* save/reset settings */
document.getElementById('saveSettings').addEventListener('click', () => {
  if (!CURRENT_USER_ID) return;
  const newName = document.getElementById('nameInput').value.trim();
  const newAvatar = document.getElementById('avatarInput').value.trim();
  const theme = document.getElementById('themeSelect').value;
  const obj = { displayName: newName || null, avatarUrl: newAvatar || null, theme };
  localStorage.setItem('user_settings_' + CURRENT_USER_ID, JSON.stringify(obj));
  if (newName) document.getElementById('usernameText').textContent = newName;
  if (newAvatar) document.getElementById('avatarImg').src = newAvatar;
  applyTheme(theme);
  settingsMenu.style.display = 'none';
});
document.getElementById('clearSettings').addEventListener('click', () => {
  if (!CURRENT_USER_ID) return;
  localStorage.removeItem('user_settings_' + CURRENT_USER_ID);
  const token = loadToken();
  if (token) fetchAndShowUser(token);
  settingsMenu.style.display = 'none';
});

/* theme application */
function applyTheme(theme) {
  if (theme === 'light') {
    document.body.classList.add('light');
  } else {
    document.body.classList.remove('light');
  }
}

/* close settings menu when clicking outside */
document.addEventListener('click', (e) => {
  const settings = document.getElementById('settingsMenu');
  const icon = document.getElementById('settingsIcon');
  if (!settings.contains(e.target) && e.target !== icon) {
    settings.style.display = 'none';
  }
});

/* Handle redirect: store token and fetch user */
async function handleRedirect() {
  const tokenFromHash = parseHashToken();
  if (tokenFromHash) {
    saveToken(tokenFromHash);
    history.replaceState({}, '', REDIRECT_URI);
  }
  const token = loadToken();
  if (token) await fetchAndShowUser(token);
  else updateOwnerAccessUI(); // ensure UI shows "You must be an owner" when no user
}

/* ---------- versions data ---------- */
const versions = [
  { v: 'DEV', state: 'download', file: 'downloads/no-available-yet.txt' },
  { v: '1.21.8', state: 'soon', file: '' },
  { v: '1.21.9', state: 'soon', file: '' },
  { v: '1.21.10', state: 'soon', file: '' },
  { v: 'soon', state: 'soon', file: '' },
  { v: 'soon', state: 'soon', file: '' },
  { v: 'soon', state: 'soon', file: '' },
  { v: 'soon', state: 'soon', file: '' }
];

const overlay = document.getElementById('overlay');
const openBtn = document.getElementById('openMenuBtn');
const closeBtn = document.getElementById('closeBtn');
const menu = overlay.querySelector('.menu');

/* per-user favorites stored in localStorage under favorites_USERID */
function getUserFavorites() {
  if (!CURRENT_USER_ID) return [];
  return JSON.parse(localStorage.getItem('favorites_' + CURRENT_USER_ID) || '[]');
}
function saveUserFavorites(arr) {
  if (!CURRENT_USER_ID) return;
  localStorage.setItem('favorites_' + CURRENT_USER_ID, JSON.stringify(arr));
}

/* build versions menu */
function buildMenu() {
  // clear
  menu.querySelectorAll('.version').forEach(n => n.remove());

  const favs = getUserFavorites();

  versions.forEach((item, idx) => {
    const div = document.createElement('div');
    div.className = 'version';

    const h = document.createElement('h4');
    h.textContent = item.v;

    const meta = document.createElement('div');
    meta.className = 'meta';

    const btnWrap = document.createElement('div');

    if (item.state === 'soon') {
      meta.textContent = 'Soon';
      const b = document.createElement('button');
      b.className = 'btn soon';
      b.textContent = 'Soon';
      btnWrap.appendChild(b);
    } else if (item.state === 'download') {
      meta.textContent = '';
      if (CURRENT_USER_ID) {
        const a = document.createElement('a');
        a.className = 'btn download';
        a.textContent = 'Download';
        a.href = item.file;
        const filename = (item.file && item.file.split('/').pop()) || 'download.bin';
        a.setAttribute('download', filename);
        btnWrap.appendChild(a);
      } else {
        const lock = document.createElement('button');
        lock.className = 'btn';
        lock.textContent = 'Login to download';
        lock.style.background = 'rgba(255,255,255,0.06)';
        lock.addEventListener('click', () => {
          window.alert('You must sign in to download.');
          document.getElementById('signInBtn').click();
        });
        btnWrap.appendChild(lock);
      }
    }

    // favorite button
    const favWrap = document.createElement('div');
    favWrap.className = 'favorite';
    const favBtn = document.createElement('button');
    favBtn.setAttribute('aria-label', 'favorite');
    favBtn.textContent = favs.includes(idx) ? '★ Favorited' : '☆ Favorite';
    favBtn.disabled = !CURRENT_USER_ID;
    favBtn.style.opacity = CURRENT_USER_ID ? '1' : '0.6';
    favBtn.addEventListener('click', () => {
      if (!CURRENT_USER_ID) {
        window.alert('Sign in to favorite versions.');
        return;
      }
      let f = getUserFavorites();
      if (f.includes(idx)) {
        f = f.filter(x => x !== idx);
        favBtn.textContent = '☆ Favorite';
      } else {
        f.push(idx);
        favBtn.textContent = '★ Favorited';
      }
      saveUserFavorites(f);
    });
    favWrap.appendChild(favBtn);

    div.appendChild(h);
    div.appendChild(meta);
    div.appendChild(btnWrap);
    div.appendChild(favWrap);
    menu.appendChild(div);
  });
}

openBtn.addEventListener('click', () => {
  buildMenu();
  overlay.style.display = 'flex';
});
closeBtn.addEventListener('click', () => overlay.style.display = 'none');
overlay.addEventListener('click', (e) => { if (e.target === overlay) overlay.style.display = 'none'; });

/* init */
window.addEventListener('load', () => {
  handleRedirect();
});
</script>

</body>
</html>
