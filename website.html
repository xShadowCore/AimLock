<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>AimLock</title>
<style>
  * { box-sizing: border-box; margin:0; padding:0; }
  body {
    font-family: "Segoe UI", Roboto, Arial, sans-serif;
    color: #fff;
    background: url('https://images.unsplash.com/photo-1570284613060-766c33850e00?q=80&w=1170&auto=format&fit=crop&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D') center/cover no-repeat fixed;
    min-height: 100vh;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 20px;
    padding: 40px 20px 80px;
  }

  /* header with top-right auth */
  .header {
    position: fixed;
    top: 18px;
    left: 20px;
    right: 20px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    pointer-events: none;
    z-index: 1000;
  }
  .brand {
    pointer-events: auto;
    background: rgba(0,0,0,0.5);
    padding: 12px 16px;
    border-radius: 10px;
    box-shadow: 0 6px 30px rgba(0,0,0,0.6);
    font-weight:700;
  }
  .auth {
    pointer-events: auto;
    display:flex;
    align-items:center;
    gap:10px;
    position: relative;
  }
  .auth .user-badge {
    display:flex;
    align-items:center;
    gap:8px;
    background: rgba(0,0,0,0.45);
    padding:6px 10px;
    border-radius:10px;
    font-size:14px;
    position: relative;
  }
  .auth img.avatar {
    width:34px;
    height:34px;
    border-radius:50%;
    object-fit:cover;
    border:1px solid rgba(255,255,255,0.06);
    cursor: pointer;
  }

  .settings-menu {
    display:none;
    position:absolute;
    top:48px;
    right:0;
    background: rgba(0,0,0,0.85);
    padding:12px;
    border-radius:10px;
    box-shadow: 0 6px 20px rgba(0,0,0,0.6);
    z-index: 1100;
    width:220px;
  }
  .settings-menu label { font-size:12px; opacity:0.9; display:block; margin-bottom:6px; }
  .settings-menu input { width:100%; padding:6px 8px; border-radius:6px; border:0; margin-bottom:8px; }

  .logo {
    background: rgba(0,0,0,0.5);
    padding: 18px 30px;
    border-radius: 12px;
    text-align: center;
    box-shadow: 0 6px 30px rgba(0,0,0,0.6);
  }
  .logo h1 { font-size: 34px; letter-spacing: 1px; margin-bottom: 6px; color: #d9b8ff; }
  .cards { display:flex; gap:24px; justify-content:center; width:100%; max-width:1100px; flex-wrap: wrap; margin-top:120px; }
  .card {
    background: rgba(10,20,30,0.45);
    padding: 26px;
    border-radius: 14px;
    width: 320px;
    text-align:center;
    border: 1px solid rgba(255,255,255,0.06);
    backdrop-filter: blur(6px);
  }
  .card h3 { margin-bottom: 8px; font-size:20px; }
  .card p { font-size:14px; color: #dfe9f2; opacity:0.9; }

  .show-versions-btn {
    position: fixed;
    bottom: 24px;
    left: 50%;
    transform: translateX(-50%);
    background: linear-gradient(90deg,#7b5fff,#a17bff);
    padding: 12px 22px;
    border-radius: 28px;
    border: none;
    color: white;
    font-size:16px;
    cursor:pointer;
    box-shadow: 0 8px 30px rgba(123,91,255,0.15);
  }

  /* Buttons */
  .btn {
    display:inline-block;
    padding:8px 12px;
    border-radius:8px;
    text-decoration:none;
    font-weight:600;
    border: none;
    cursor:pointer;
  }

  .btn.discord {
    background: linear-gradient(90deg,#7289da,#99a9ff);
    color: #fff;
    font-weight: 700;
    padding: 10px 18px;
    border-radius: 24px;
    border: none;
    cursor: pointer;
    transition: all 0.3s ease;
    box-shadow: 0 6px 20px rgba(114,137,218,0.4);
  }
  .btn.discord:hover {
    background: linear-gradient(90deg,#99a9ff,#7289da);
    transform: translateY(-3px);
    box-shadow: 0 8px 25px rgba(114,137,218,0.5);
  }
  .btn.discord:active {
    transform: translateY(0);
    box-shadow: 0 4px 15px rgba(114,137,218,0.3);
  }

  .btn.tiktok {
    background: linear-gradient(90deg,#25f4ee,#fe2c55);
    color: #fff;
    font-weight: 700;
    padding: 10px 18px;
    border-radius: 24px;
    border: none;
    cursor: pointer;
    transition: all 0.3s ease;
    box-shadow: 0 6px 20px rgba(255,44,85,0.4);
  }
  .btn.tiktok:hover {
    background: linear-gradient(90deg,#fe2c55,#25f4ee);
    transform: translateY(-3px);
    box-shadow: 0 8px 25px rgba(255,44,85,0.5);
  }
  .btn.tiktok:active {
    transform: translateY(0);
    box-shadow: 0 4px 15px rgba(255,44,85,0.3);
  }

  .btn.soon { background: rgba(255,255,255,0.06); color: #eee; cursor: default; }
  .btn.download {
    background: linear-gradient(90deg,#6fb3ff,#7b5fff);
    color:#041024;
  }

  .favorite {
    display:inline-flex;
    gap:6px;
    align-items:center;
    margin-top:8px;
  }
  .favorite button { background:transparent; border:1px solid rgba(255,255,255,0.06); color:#fff; padding:6px 8px; border-radius:8px; cursor:pointer; }

  .overlay {
    position: fixed;
    inset: 0;
    display: none;
    align-items: center;
    justify-content: center;
    background: rgba(6,8,12,0.6);
    z-index: 999;
    padding: 20px;
  }
  .menu {
    width: 100%;
    max-width: 760px;
    background: rgba(4,6,12,0.6);
    padding: 22px;
    border-radius: 12px;
    display: grid;
    grid-template-columns: repeat(2,1fr);
    gap: 12px;
    border: 1px solid rgba(255,255,255,0.05);
    position: relative;
  }
  .version {
    background: rgba(255,255,255,0.03);
    padding: 12px;
    border-radius: 8px;
    text-align:center;
  }
  .version h4 { margin-bottom:6px; }
  .version .meta { margin-bottom:8px; opacity:0.9; }

  .close-x {
    position:absolute;
    top:20px;
    right:20px;
    color:#fff;
    font-size:18px;
    background:transparent;
    border:0;
    cursor:pointer;
  }

  @media (max-width:700px) {
    .cards { flex-direction: column; align-items:center; }
    .menu { grid-template-columns: 1fr; }
  }
</style>
</head>
<body>

  <div class="header">
    <div class="brand">AimLock</div>
    <div class="auth" id="authArea">
      <div id="userBadge" style="display:none;" class="user-badge">
        <img id="avatarImg" class="avatar" src="" alt="avatar" title="Click to open settings">
        <div id="usernameText"></div>
        <button id="signOutBtn" class="btn" style="margin-left:8px; padding:6px 10px; border-radius:8px; background:rgba(255,255,255,0.06); color:#fff;">Sign out</button>

        <div id="settingsMenu" class="settings-menu" role="menu" aria-hidden="true">
          <label for="nameInput">Display name</label>
          <input id="nameInput" placeholder="Display name">
          <label for="avatarInput">Avatar URL</label>
          <input id="avatarInput" placeholder="https://...">
          <div style="display:flex; gap:8px; justify-content:flex-end; margin-top:6px;">
            <button id="saveSettings" class="btn">Save</button>
            <button id="clearSettings" class="btn" style="background:rgba(255,255,255,0.06)">Reset</button>
          </div>
        </div>

      </div>
      <button id="signInBtn" class="btn discord">Register / Sign in</button>
    </div>
  </div>

  <div class="logo">
    <h1>AimLock</h1>
    <div>The HackClient for Minecraft</div>
  </div>

  <div class="cards" aria-hidden="true">
    <div class="card">
      <h3>Our Discord</h3>
      <p>Join our Discord for support and The mod</p>
      <button class="btn discord" onclick="window.open('https://discord.com/invite/NMxqjrJ4Au','_blank')">Discord</button>
    </div>

    <div class="card">
      <h3>TikTok</h3>
      <p>Follow us on TikTok for updates!</p>
      <button class="btn tiktok" onclick="window.open('https://www.tiktok.com','_blank')">TikTok</button>
    </div>

    <div class="card">
      <h3>Owners</h3>
      <p>xShadowCore<br>UserID: 1109112702347006053</p>
    </div>

    <div class="card">
      <h3>Status</h3>
      <p>The mod is currently still in development. Join our Discord to not miss the release.</p>
    </div>
  </div>

  <button class="show-versions-btn" id="openMenuBtn">Show versions</button>

  <div class="overlay" id="overlay">
    <div class="menu" role="dialog" aria-modal="true" aria-label="Menu">
      <button class="close-x" id="closeBtn" title="Close">✕</button>
    </div>
  </div>

<script>
/* ---------- OAUTH CONFIG (filled with values you supplied) ---------- */
const CLIENT_ID = '1441317350010785962';
const REDIRECT_URI = 'https://xshadowcore.github.io/AIMbot/website';
const SCOPES = 'identify';
/* ------------------------------------------------------------------- */

/* Utility to build the OAuth URL (implicit flow for static site) */
function buildDiscordOAuthUrl() {
  const base = 'https://discord.com/oauth2/authorize';
  const params = new URLSearchParams({
    client_id: CLIENT_ID,
    redirect_uri: REDIRECT_URI,
    response_type: 'token',
    scope: SCOPES,
    prompt: 'consent'
  });
  return `${base}?${params.toString()}`;
}

/* parse token from URL hash */
function parseHashToken() {
  if (!window.location.hash) return null;
  const hash = window.location.hash.substring(1);
  const params = new URLSearchParams(hash);
  return params.get('access_token');
}

/* token storage */
function saveToken(token) { if (!token) return; sessionStorage.setItem('discord_token', token); }
function loadToken() { return sessionStorage.getItem('discord_token'); }
function clearToken() { sessionStorage.removeItem('discord_token'); }

/* small helper for default avatar */
function defaultAvatarUrl(discriminator) {
  const idx = (parseInt(discriminator) || 0) % 5;
  return `https://cdn.discordapp.com/embed/avatars/${idx}.png`;
}
function avatarUrl(user) {
  if (!user) return defaultAvatarUrl(0);
  if (user.avatar) {
    const isAnimated = user.avatar.startsWith('a_');
    const ext = isAnimated ? 'gif' : 'png';
    return `https://cdn.discordapp.com/avatars/${user.id}/${user.avatar}.${ext}`;
  }
  return defaultAvatarUrl(user.discriminator);
}

/* current logged in user id */
let CURRENT_USER_ID = null;

/* fetch user and show UI */
async function fetchAndShowUser(token) {
  try {
    const res = await fetch('https://discord.com/api/users/@me', {
      headers: { Authorization: `Bearer ${token}`, Accept: 'application/json' }
    });
    if (!res.ok) {
      signOut();
      return;
    }
    const user = await res.json();
    CURRENT_USER_ID = user.id;

    // load user-specific settings from localStorage if present
    const saved = JSON.parse(localStorage.getItem('user_settings_' + user.id) || 'null');
    const displayName = (saved && saved.displayName) ? saved.displayName : `${user.username}#${user.discriminator}`;
    const avatarSrc = (saved && saved.avatarUrl) ? saved.avatarUrl : avatarUrl(user);

    document.getElementById('avatarImg').src = avatarSrc;
    document.getElementById('usernameText').textContent = displayName;

    // fill settings inputs
    document.getElementById('nameInput').value = saved && saved.displayName ? saved.displayName : '';
    document.getElementById('avatarInput').value = saved && saved.avatarUrl ? saved.avatarUrl : '';

    document.getElementById('userBadge').style.display = 'flex';
    document.getElementById('signInBtn').style.display = 'none';
  } catch (err) {
    console.error('Error fetching Discord user:', err);
  }
}

/* sign in / out handlers */
document.getElementById('signInBtn').addEventListener('click', () => {
  window.location.href = buildDiscordOAuthUrl();
});
document.getElementById('signOutBtn').addEventListener('click', () => {
  signOut();
});

function signOut() {
  clearToken();
  CURRENT_USER_ID = null;
  document.getElementById('userBadge').style.display = 'none';
  document.getElementById('signInBtn').style.display = 'inline-block';
  // optionally clean URL
  history.replaceState({}, '', REDIRECT_URI);
}

/* settings menu behavior */
const avatarImgEl = document.getElementById('avatarImg');
const settingsMenu = document.getElementById('settingsMenu');
avatarImgEl.addEventListener('click', (e) => {
  // only show if logged in
  if (!CURRENT_USER_ID) return;
  settingsMenu.style.display = settingsMenu.style.display === 'block' ? 'none' : 'block';
});
document.getElementById('saveSettings').addEventListener('click', () => {
  if (!CURRENT_USER_ID) return;
  const newName = document.getElementById('nameInput').value.trim();
  const newAvatar = document.getElementById('avatarInput').value.trim();
  const obj = { displayName: newName || null, avatarUrl: newAvatar || null };
  localStorage.setItem('user_settings_' + CURRENT_USER_ID, JSON.stringify(obj));
  if (newName) document.getElementById('usernameText').textContent = newName;
  if (newAvatar) document.getElementById('avatarImg').src = newAvatar;
  settingsMenu.style.display = 'none';
});
document.getElementById('clearSettings').addEventListener('click', () => {
  if (!CURRENT_USER_ID) return;
  localStorage.removeItem('user_settings_' + CURRENT_USER_ID);
  // reload stored user info from Discord (token must still be valid)
  const token = loadToken();
  if (token) fetchAndShowUser(token);
  settingsMenu.style.display = 'none';
});

/* Handle OAuth redirect and load user */
async function handleRedirect() {
  const tokenFromHash = parseHashToken();
  if (tokenFromHash) {
    saveToken(tokenFromHash);
    // remove hash from URL
    history.replaceState({}, '', REDIRECT_URI);
  }
  const token = loadToken();
  if (token) await fetchAndShowUser(token);
}

/* ---------- versions menu ---------- */
const versions = [
  { v: 'DEV', state: 'download', file: 'downloads/no-available-yet.txt' },
  { v: '1.21.8', state: 'soon', file: '' },
  { v: '1.21.9', state: 'soon', file: '' },
  { v: '1.21.10', state: 'soon', file: '' },
  { v: 'soon', state: 'soon', file: '' },
  { v: 'soon', state: 'soon', file: '' },
  { v: 'soon', state: 'soon', file: '' },
  { v: 'soon', state: 'soon', file: '' }
];

const overlay = document.getElementById('overlay');
const openBtn = document.getElementById('openMenuBtn');
const closeBtn = document.getElementById('closeBtn');
const menu = overlay.querySelector('.menu');

/* helper: get favorites for current user (array of version indices) */
function getUserFavorites() {
  if (!CURRENT_USER_ID) return [];
  return JSON.parse(localStorage.getItem('favorites_' + CURRENT_USER_ID) || '[]');
}
function saveUserFavorites(arr) {
  if (!CURRENT_USER_ID) return;
  localStorage.setItem('favorites_' + CURRENT_USER_ID, JSON.stringify(arr));
}

/* build menu with gated downloads and favorite buttons */
function buildMenu() {
  const existing = menu.querySelectorAll('.version');
  existing.forEach(n => n.remove());

  const favs = getUserFavorites();

  versions.forEach((item, idx) => {
    const div = document.createElement('div');
    div.className = 'version';

    const h = document.createElement('h4');
    h.textContent = item.v;

    const meta = document.createElement('div');
    meta.className = 'meta';

    const btnWrap = document.createElement('div');

    if (item.state === 'soon') {
      meta.textContent = 'Soon';
      const b = document.createElement('button');
      b.className = 'btn soon';
      b.textContent = 'Soon';
      btnWrap.appendChild(b);
    } else if (item.state === 'download') {
      meta.textContent = '';
      if (CURRENT_USER_ID) {
        const a = document.createElement('a');
        a.className = 'btn download';
        a.textContent = 'Download';
        a.href = item.file;
        const filename = (item.file && item.file.split('/').pop()) || 'download.bin';
        a.setAttribute('download', filename);
        btnWrap.appendChild(a);
      } else {
        const lock = document.createElement('button');
        lock.className = 'btn';
        lock.textContent = 'Login to download';
        lock.style.background = 'rgba(255,255,255,0.06)';
        lock.addEventListener('click', () => {
          // prompt sign in
          window.alert('You must sign in to download.');
          document.getElementById('signInBtn').click();
        });
        btnWrap.appendChild(lock);
      }
    }

    // favorite button (only if logged in)
    const favWrap = document.createElement('div');
    favWrap.className = 'favorite';
    const favBtn = document.createElement('button');
    favBtn.setAttribute('aria-label', 'favorite');
    favBtn.textContent = favs.includes(idx) ? '★ Favorited' : '☆ Favorite';
    favBtn.disabled = !CURRENT_USER_ID;
    favBtn.style.opacity = CURRENT_USER_ID ? '1' : '0.6';
    favBtn.addEventListener('click', () => {
      if (!CURRENT_USER_ID) {
        window.alert('Sign in to favorite versions.');
        return;
      }
      let f = getUserFavorites();
      if (f.includes(idx)) {
        f = f.filter(x => x !== idx);
        favBtn.textContent = '☆ Favorite';
      } else {
        f.push(idx);
        favBtn.textContent = '★ Favorited';
      }
      saveUserFavorites(f);
    });
    favWrap.appendChild(favBtn);

    div.appendChild(h);
    div.appendChild(meta);
    div.appendChild(btnWrap);
    div.appendChild(favWrap);
    menu.appendChild(div);
  });
}

openBtn.addEventListener('click', () => {
  buildMenu();
  overlay.style.display = 'flex';
});
closeBtn.addEventListener('click', () => overlay.style.display = 'none');
overlay.addEventListener('click', (e) => { if (e.target === overlay) overlay.style.display = 'none'; });

/* close settings menu when clicking outside */
document.addEventListener('click', (e) => {
  const settings = document.getElementById('settingsMenu');
  const avatar = document.getElementById('avatarImg');
  if (!settings.contains(e.target) && e.target !== avatar) {
    settings.style.display = 'none';
  }
});

/* initialise on load */
window.addEventListener('load', () => {
  handleRedirect();
});
</script>

</body>
</html>
